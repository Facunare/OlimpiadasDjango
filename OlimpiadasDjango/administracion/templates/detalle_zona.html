{% extends 'base.html' %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agregar Zona</title>
</head>
<body>
    {% block content %}
        <div class="main">
            {% if user.is_authenticated and user.is_staff %}
            <form action="{% url 'agregarPaciente' %}" method="POST" class="formAddPatience">
                {% csrf_token %}
                <input type="hidden" name="zona_id" value="{{zona.id}}">
                <button>
                    Agregar paciente
                </button>
                <h1>Quir√≥fano</h1>
            </form>
            {% endif %}

            <div class="pacientes">

                {% if pacientes %}
                    {% for paciente in pacientes %}
                    <a class="paciente {% if paciente.perfil.isCalling %} pacienteLlamando {% elif paciente.perfil.isCallingNormal%} pacienteLlamandoNormal {% endif %}">
                        <p>{{paciente.dni_paciente}} | {{paciente.nombre_paciente}} {{paciente.apellido_paciente}} | {{paciente.zona.nombre_zona}} | {{paciente.medico_asignado.nombre_medico}} - {% if paciente.perfil.isCalling %} Llamada de emergencia {% elif paciente.perfil.isCallingNormal%} Llamada normal {% endif %}</p>
                        <div class="buttons">
                            <div>
                                <button class="asignarMedico">Asignar enfermero</button>
                            </div>
                            {% if paciente.perfil.isCalling or paciente.perfil.isCallingNormal %}
                            <form action="{% url 'generarReporte' paciente.id %}">
                                <button class="generarReporte">Generar reporte</button>
                            </form>
                            {% endif %}
                            <form action="{% url 'editar_paciente' paciente.id %}">
                                {% csrf_token %}
                                <button class="editar">Editar</button>
                            </form>
                            <form action="{% url 'eliminarPaciente' paciente.id %}?return_url={{ request.path }}">
                                {% csrf_token %}
                                <button class="eliminar">Eliminar</button>
                            </form>
                        </div>
                    </a>
                        <section class="modal">
                            <div class="modal_container">
                                <button href="#" class="modal_close">X</button>
                                <h1>Asignar enfermero</h1>
                                <form action="{% url "asignarMedico" paciente.id %}?return_url={{ request.path }}" method="POST">
                                    {% csrf_token %}
                                    <select name="medico_id" id="medico_id">
                                        {% for medico in medicos %}
                                            <option value="{{ medico.id }}">{{medico.nombre_medico}}</option>
                                            <input type="hidden" name="medico_id" value="{{medico.id}}">
                                        {% endfor %}
                                    </select>
                                    <button>Asignar</button>
                                </form>
                            </div>
                        </section>
                    {% endfor %}
                {% else %}
                    <p class="noHay">No hay ningun paciente en este momento</p>
                {% endif %}
            </div>
        </div>
    <style>
        .formAddPatience button {
            background: #1561b8;
            color: white;
            border: none;
            outline: none;
            padding: 10px;
            font-size: 20px;
            -webkit-box-shadow: 0 0 5px #236bbd;
                    box-shadow: 0 0 5px #236bbd;
            -webkit-transition: 0.2s;
            cursor: pointer;
            transition: 0.2s;
          }
          
          h1{
            padding-left: 15px;
          }
          .formAddPatience button:hover:active {
            background: #1e589b;
            scale: 1.02;
          }
        .noHay{
            font-size: 30px;
            text-align: center;
            margin-top: 50px;
        }
        .buttons{
            display: flex;
            gap: 20px;
        }

        .pacienteLlamando{
            background: red;
            color: white;
        }

        .pacienteLlamandoNormal{
            background: orange;
        }
        .modal form{
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-top: 50px;
        }

        .modal form select{
            height: 50px;
        }
        form input{
            padding: 10px;
            border: 1px solid black;
            outline: none;
            margin: 0;
            display: flex;
            width: 200px;
        }

        form .addButton{
            width: 223px;
            margin: 0;
            cursor: pointer;
            color: white;
            padding: 10px;
            background-color: rgb(20, 20, 129);
        }

        .main{
            display: flex;
            width: 100vw;
        }

        .paciente{
            border: 1px solid black;
            padding: 5px;
            display: flex;
            cursor: pointer;
            justify-content: space-between;
        }

        .pacientes{
            width: 100vw;
        }

        .buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;           
        }
        
        button {
            padding: 2px 10px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
            outline: none;
        }
        
        .asignarMedico {
            background-color: #3498db;
            color: #fff;
        }
        
        .generarReporte {
            background-color: #27ae60;
            color: #fff;
        }
        
        .editar {
            background-color: #e67e22;
            color: #fff;
        }
        
        .eliminar {
            background-color: #e74c3c;
            color: #fff;
        }
        
        button:hover {
            opacity: 0.9;
        }


    </style>
    <script>
        const asignarMedico = document.querySelectorAll('.asignarMedico')
        const editButton = document.querySelectorAll(".editButton")
        const modalMedico = document.querySelector('.modal')
        const modal_editar = document.querySelector(".modal_editar")
        const modal_close = document.querySelectorAll('.modal_close')
        editButton.forEach(button =>{
            button.addEventListener('click', (e)=>{
                e.preventDefault()
                modal_editar.classList.add("modal--show")
            })
        })

        asignarMedico.forEach(button=>{

            button.addEventListener('click', (e)=>{
              e.preventDefault()
              modalMedico.classList.add('modal--show')
            })
        })
    
        modal_close.forEach(button=>{

            button.addEventListener('click', (e)=>{
              e.preventDefault()
              modalMedico.classList.remove('modal--show')
              modal_editar.classList.remove("modal--show")
        })
        })
    </script>
    {% endblock content %}

    
</body>
</html>